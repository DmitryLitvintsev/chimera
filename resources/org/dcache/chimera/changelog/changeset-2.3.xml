<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
     xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
     http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet id="10" author="tigran">
        <dropForeignKeyConstraint baseTableName="t_level_1"
                                 constraintName="t_level_1_ipnfsid_fkey"
        />

        <dropForeignKeyConstraint baseTableName="t_level_2"
                                 constraintName="t_level_2_ipnfsid_fkey"
        />

        <dropForeignKeyConstraint baseTableName="t_level_3"
                                 constraintName="t_level_3_ipnfsid_fkey"
        />

        <dropForeignKeyConstraint baseTableName="t_level_4"
                                 constraintName="t_level_4_ipnfsid_fkey"
        />

        <dropForeignKeyConstraint baseTableName="t_level_5"
                                 constraintName="t_level_5_ipnfsid_fkey"
        />

        <dropForeignKeyConstraint baseTableName="t_level_6"
                                 constraintName="t_level_6_ipnfsid_fkey"
        />

        <dropForeignKeyConstraint baseTableName="t_level_7"
                                 constraintName="t_level_7_ipnfsid_fkey"
        />
    </changeSet>

    <changeSet id="11" author="tigran">
        <addForeignKeyConstraint baseColumnNames="ipnfsid" baseTableName="t_level_1"
                                         constraintName="t_level_1_ipnfsid_fkey"
                                         deferrable="false"
                                         initiallyDeferred="false"
                                         onDelete="CASCADE"
                                         onUpdate="NO ACTION"
                                         referencedColumnNames="ipnfsid"
                                         referencedTableName="t_inodes"
        />

        <addForeignKeyConstraint baseColumnNames="ipnfsid" baseTableName="t_level_2"
                                 constraintName="t_level_2_ipnfsid_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="ipnfsid"
                                 referencedTableName="t_inodes"
        />

        <addForeignKeyConstraint baseColumnNames="ipnfsid" baseTableName="t_level_3"
                                 constraintName="t_level_3_ipnfsid_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="ipnfsid"
                                 referencedTableName="t_inodes"
        />

        <addForeignKeyConstraint baseColumnNames="ipnfsid" baseTableName="t_level_4"
                                 constraintName="t_level_4_ipnfsid_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="ipnfsid"
                                 referencedTableName="t_inodes"
        />

        <addForeignKeyConstraint baseColumnNames="ipnfsid" baseTableName="t_level_5"
                                 constraintName="t_level_5_ipnfsid_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="ipnfsid"
                                 referencedTableName="t_inodes"
        />

        <addForeignKeyConstraint baseColumnNames="ipnfsid" baseTableName="t_level_6"
                                 constraintName="t_level_6_ipnfsid_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="ipnfsid"
                                 referencedTableName="t_inodes"
        />

        <addForeignKeyConstraint baseColumnNames="ipnfsid" baseTableName="t_level_7"
                                 constraintName="t_level_7_ipnfsid_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="ipnfsid"
                                 referencedTableName="t_inodes"
        />
    </changeSet>

    <changeSet id="13" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_inodes' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_inodes" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="14" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_dirs' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_dirs" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="15" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_dirs' AND column_name='iparent'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_dirs" columnName="iparent" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="16" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_inodes_data' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_inodes_data" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="17" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_inodes_checksum' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_inodes_checksum" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="18" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_acl' AND column_name='rs_id'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_acl" columnName="rs_id" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="19" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_level_1' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_level_1" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="20" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_level_2' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_level_2" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="21" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_level_3' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_level_3" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="22" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_level_4' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_level_4" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="23" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_level_5' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_level_5" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="24" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_level_6' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_level_6" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="25" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_level_7' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_level_7" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="26" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_access_latency' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_access_latency" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="27" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_retention_policy' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_retention_policy" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="28" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_locationinfo' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_locationinfo" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="29" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_locationinfo_trash' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_locationinfo_trash" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="30" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_storageinfo' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_storageinfo" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="31" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_tags' AND column_name='ipnfsid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_tags" columnName="ipnfsid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="32" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_tags' AND column_name='itagid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_tags" columnName="itagid" newDataType="VARCHAR(36)" />

    </changeSet>

    <changeSet id="33" author="tigran" dbms="postgresql">

        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="character varying">
                    SELECT data_type FROM information_schema.columns WHERE table_name='t_tags_inodes' AND column_name='itagid'
                </sqlCheck>
            </not>
        </preConditions>
        <modifyDataType tableName="t_tags_inodes" columnName="itagid" newDataType="VARCHAR(36)" />

    </changeSet>

</databaseChangeLog>